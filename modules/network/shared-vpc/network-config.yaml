#######################################################################################################################
# For additional configurable services, features, and property descriptions,                                          #
# please review the NetworkConfig class reference in our TypeDoc:                                                     #
# https://awslabs.github.io/landing-zone-accelerator-on-aws/latest/user-guide/config/#network-configuration           #
#######################################################################################################################

defaultVpc:
  delete: true
  excludeAccounts: []

# AWS Transit Gateway Configurations
transitGateways:
  - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
    account: Network
    region: "{{ HomeRegion }}"
    shareTargets:
      organizationalUnits:
        - Infrastructure
    asn: {{ TransitGatewayASN }}
    dnsSupport: enable
    vpnEcmpSupport: enable
    defaultRouteTableAssociation: disable
    defaultRouteTablePropagation: disable
    autoAcceptSharingAttachments: enable
    routeTables:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-firewall"
        routes:
          - destinationCidrBlock: 0.0.0.0/0
            attachment:
              vpcName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress"
              account: Perimeter
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-spoke"
        routes:
          - destinationCidrBlock: 0.0.0.0/0
            attachment:
              vpcName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection"
              account: Network

centralNetworkServices:
  delegatedAdminAccount: Network
  gatewayLoadBalancers: []
  ipams:
    - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam"
      region: "{{ HomeRegion }}"
      description: IP regional allocation for LZA.
      operatingRegions:
        - "{{ HomeRegion }}"
      scopes: []
      pools:
        - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-global-pool"
          description: IP global pool allocation for LZA.
          provisionedCidrs:
            - "{{ GlobalCidr}}"
          tags:
            - key: Accelerator
              value: "{{ AcceleratorPrefix }}"
        - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-regional-pool"
          description: IP regional pool allocation for LZA
          provisionedCidrs:
            - "{{ HomeRegionRegionalCidr}}"
          sourceIpamPool: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-global-pool"
          tags:
            - key: Accelerator
              value: "{{ AcceleratorPrefix }}"
        - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-ingress-pool"
          description: IP regional pool allocation for the Perimeter LZA account
          locale: "{{ HomeRegion }}"
          provisionedCidrs:
            - "{{ HomeRegionIngressCidr }}"
          sourceIpamPool: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-regional-pool"
          tags:
            - key: Accelerator
              value: "{{ AcceleratorPrefix }}"
          shareTargets:
            accounts:
              - Perimeter
        - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-egress-pool"
          description: IP regional pool allocation for the Perimeter LZA account
          locale: "{{ HomeRegion }}"
          provisionedCidrs:
            - "{{ HomeRegionEgressCidr }}"
          sourceIpamPool: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-regional-pool"
          tags:
            - key: Accelerator
              value: "{{ AcceleratorPrefix }}"
          shareTargets:
            accounts:
              - Perimeter
        - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-inspection-pool"
          description: IP regional pool allocation for the Network LZA account
          locale: "{{ HomeRegion }}"
          provisionedCidrs:
            - "{{ HomeRegionInspectionCidr }}"
          sourceIpamPool: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-regional-pool"
          tags:
            - key: Accelerator
              value: "{{ AcceleratorPrefix }}"
          shareTargets:
            accounts:
              - Network
        - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-endpoints-pool"
          description: IP regional pool allocation for the Network LZA account
          locale: "{{ HomeRegion }}"
          provisionedCidrs:
            - "{{ HomeRegionEndpointsCidr }}"
          sourceIpamPool: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-regional-pool"
          tags:
            - key: Accelerator
              value: "{{ AcceleratorPrefix }}"
          shareTargets:
            accounts:
              - Network
        - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-sharedservices-pool"
          description: IP regional pool allocation for the SharedServices LZA account
          locale: "{{ HomeRegion }}"
          provisionedCidrs:
            - "{{ HomeRegionSharedServicesCidr }}"
          sourceIpamPool: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-regional-pool"
          tags:
            - key: Accelerator
              value: "{{ AcceleratorPrefix }}"
          shareTargets:
            accounts:
              - SharedServices
        - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-dev-pool"
          description: IP regional pool allocation for Dev LZA accounts
          locale: "{{ HomeRegion }}"
          provisionedCidrs:
            - "{{ HomeRegionDevWorkloadsCidr }}"
          sourceIpamPool: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-regional-pool"
          tags:
            - key: Accelerator
              value: "{{ AcceleratorPrefix }}"
          shareTargets:
            accounts:
              - Network
        - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-test-pool"
          description: IP regional pool allocation for Test LZA accounts
          locale: "{{ HomeRegion }}"
          provisionedCidrs:
            - "{{ HomeRegionTestWorkloadsCidr }}"
          sourceIpamPool: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-regional-pool"
          tags:
            - key: Accelerator
              value: "{{ AcceleratorPrefix }}"
          shareTargets:
            accounts:
              - Network
        - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-prod-pool"
          description: IP regional pool allocation for Prod LZA accounts
          locale: "{{ HomeRegion }}"
          provisionedCidrs:
            - "{{ HomeRegionProdWorkloadsCidr }}"
          sourceIpamPool: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-regional-pool"
          tags:
            - key: Accelerator
              value: "{{ AcceleratorPrefix }}"
          shareTargets:
            accounts:
              - Network

  networkFirewall:
    firewalls:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-nfw"
        firewallPolicy: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-nfw-policy"
        subnets:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-fw-a"
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-fw-b"
        vpc: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection"
        loggingConfiguration:
          - destination: cloud-watch-logs # Logs will automatically be forwarded to S3
            type: ALERT
          - destination: cloud-watch-logs # Logs will automatically be forwarded to S3
            type: FLOW
        tags:
          - key: Accelerator
            value: "{{ AcceleratorPrefix }}"
    policies:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-nfw-policy"
        regions:
          - "{{ HomeRegion }}"
        firewallPolicy:
          statelessDefaultActions: ["aws:forward_to_sfe"]
          statelessFragmentDefaultActions: ["aws:forward_to_sfe"]
          statefulRuleGroups:
            - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-nfw-stateful-rule-group"
        shareTargets:
          # Firewall rules are shared automatically with Network account (owner)
          # Add additional accounts/Organizational units (OUs) only if broader sharing is required
          accounts: []
    rules:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-nfw-stateful-rule-group"
        regions:
          - "{{ HomeRegion }}"
        capacity: 1000
        type: STATEFUL
        ruleGroup:
          rulesSource:
            rulesFile: firewall-rules/rules.txt
          ruleVariables:
            ipSets:
              - name: HOME_NET
                definition:
                  - "{{ HomeRegionRegionalCidr }}"
              - name: HOME_REGION_ENDPOINTS
                definition:
                  - "{{ HomeRegionEndpointsCidr }}"
              - name: HOME_REGION_DEV_POOL
                definition:
                  - "{{ HomeRegionDevWorkloadsCidr }}"
              - name: HOME_REGION_TEST_POOL
                definition:
                  - "{{ HomeRegionTestWorkloadsCidr }}"
              - name: HOME_REGION_PROD_POOL
                definition:
                  - "{{ HomeRegionProdWorkloadsCidr }}"
              - name: HOME_REGION_SHARED_SERVICES_POOL
                definition:
                  - "{{ HomeRegionSharedServicesCidr }}"
            portSets:
              - name: HOME_REGION_SS_PORTS
                definition: ["443"]
        shareTargets:
          # Firewall rules are shared automatically with Network account (owner)
          # Add additional accounts/Organizational units (OUs) only if broader sharing is required
          accounts: []

endpointPolicies:
  # Endpoint policies
  #   - Use these policies to define standard policies for VPC endpoints
  - name: Endpoint-Default
    document: vpc-endpoint-policies/default.json

vpcs:
  # VPC Endpoints
  #  - Deploys to network account
  #  - Utilizes two AZs for deployments of subnets,leaving space for 3rd AZ
  #    - Endpoints Subnet
  #    - Transit Gateway attachment subnet
  #  - This VPC is intended to host AWS service endpoints
  #    - Enable API access to services without traversing the Egress VPC (Internet Access)
  - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints"
    account: Network
    region: "{{ HomeRegion }}"
    ipamAllocations:
      - ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-endpoints-pool"
        netmaskLength: {{ HomeRegionIngressEndpointsVpcMaskLength }}
    defaultSecurityGroupRulesDeletion: true
    internetGateway: false
    enableDnsHostnames: true
    enableDnsSupport: true
    instanceTenancy: default
    routeTables:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-rt-a"
        routes:
          - name: TgwRoute
            destination: 0.0.0.0/0
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          - name: S3Gateway
            type: gatewayEndpoint
            target: s3
          - name: DynamoDBGateway
            type: gatewayEndpoint
            target: dynamodb
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-rt-b"
        routes:
          - name: TgwRoute
            destination: 0.0.0.0/0
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          - name: S3Gateway
            type: gatewayEndpoint
            target: s3
          - name: DynamoDBGateway
            type: gatewayEndpoint
            target: dynamodb
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-rt-tgw-a"
        routes: []
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-rt-tgw-b"
        routes: []
    subnets:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-rt-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-endpoints-pool"
          netmaskLength: {{ HomeRegionIngressEndpointsSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-rt-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-endpoints-pool"
          netmaskLength: {{ HomeRegionIngressEndpointsSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-tgw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-rt-tgw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-endpoints-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-Tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-tgw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-rt-tgw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-endpoints-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-Tgw"
    transitGatewayAttachments:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints"
        transitGateway:
          name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          account: Network
        routeTableAssociations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-spoke"
        routeTablePropagations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-firewall"
        subnets:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-tgw-a"
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-tgw-b"
    gatewayEndpoints:
      defaultPolicy: Endpoint-Default
      endpoints:
        - service: s3
        - service: dynamodb
    interfaceEndpoints:
      defaultPolicy: Endpoint-Default
      central: true
      subnets:
        - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-a"
        - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-endpoints-b"
      # Note: VPC endpoint availability varies by AWS Region and Availability Zone.
      # Review and adjust the endpoint list based on your specific region's service availability.
      # Some endpoints may need to be commented out if not supported in your environment.
      endpoints:
        - service: ec2
        - service: ec2messages
        - service: ecr.api
        - service: ecr.dkr
        - service: kms
        - service: logs
        - service: monitoring
        - service: ssm
        # - service: ssm-contacts
        - service: ssm-incidents
        - service: ssmmessages

  # VPC Ingress
  #  - Deploys to perimeter account
  #  - Utilizes two AZs for deployments of subnets, leaving space for 3rd AZ
  #     - Firewall Subnet - currently not used but provisioned if you require a firewall
  #     - Public Subnet
  #     - Transit Gateway attachment subnet
  #  - This VPC is intended to load balancers or similar services
  - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress"
    account: Perimeter
    region: "{{ HomeRegion }}"
    ipamAllocations:
      - ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-ingress-pool"
        netmaskLength: {{ HomeRegionIngressVpcMaskLength }}
    defaultSecurityGroupRulesDeletion: true
    internetGateway: true
    enableDnsHostnames: true
    enableDnsSupport: true
    instanceTenancy: default
    routeTables:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-fw-a"
        routes: []
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-fw-b"
        routes: []
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-public-a"
        routes:
          - name: TgwRoute
            destination: "{{ GlobalCidr }}"
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          - name: Internet
            destination: 0.0.0.0/0
            type: internetGateway
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-public-b"
        routes:
          - name: TgwRoute
            destination: "{{ GlobalCidr }}"
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          - name: Internet
            destination: 0.0.0.0/0
            type: internetGateway
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-tgw-a"
        routes:
          - name: TgwRoute
            destination: "{{ GlobalCidr }}"
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-tgw-b"
        routes:
          - name: TgwRoute
            destination: "{{ GlobalCidr }}"
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
    subnets:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-fw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-fw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-ingress-pool"
          netmaskLength: {{ HomeRegionIngressFwSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-fw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-fw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-ingress-pool"
          netmaskLength: {{ HomeRegionIngressFwSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-public-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-public-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-ingress-pool"
          netmaskLength: {{ HomeRegionIngressPublicSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-public-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-public-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-ingress-pool"
          netmaskLength: {{ HomeRegionIngressPublicSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-tgw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-tgw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-ingress-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-Tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-tgw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-rt-tgw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-ingress-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-Tgw"
    transitGatewayAttachments:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress"
        transitGateway:
          name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          account: Network
        routeTableAssociations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-spoke"
        routeTablePropagations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-firewall"
        subnets:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-tgw-a"
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ingress-tgw-b"
    gatewayEndpoints:
      defaultPolicy: Endpoint-Default
      endpoints:
        - service: s3
        - service: dynamodb
    useCentralEndpoints: true

  # VPC Egress
  #  - Deploys to network account
  #  - Utilizes two AZs for deployments of subnets, leaving space for 3rd AZ
  #     - Firewall Subnet - currently not used but provisioned if you require a firewall
  #     - Public Subnet
  #     - Transit Gateway attachment subnet
  #  - This VPC is intended to host NAT Gateway devices providing internet access for your VPCs
  - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress"
    account: Perimeter
    region: "{{ HomeRegion }}"
    ipamAllocations:
      - ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-egress-pool"
        netmaskLength: {{ HomeRegionEgressVpcMaskLength }}
    defaultSecurityGroupRulesDeletion: true
    internetGateway: true
    enableDnsHostnames: true
    enableDnsSupport: true
    instanceTenancy: default
    routeTables:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-fw-a"
        routes: []
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-fw-b"
        routes: []
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-public-a"
        routes:
          - name: TgwRoute
            destination: "{{ GlobalCidr }}"
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          - name: Internet
            destination: 0.0.0.0/0
            type: internetGateway
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-public-b"
        routes:
          - name: TgwRoute
            destination: "{{ GlobalCidr }}"
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          - name: Internet
            destination: 0.0.0.0/0
            type: internetGateway
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-tgw-a"
        routes:
          - name: TgwRoute
            destination: "{{ GlobalCidr }}"
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          - name: Internet
            destination: 0.0.0.0/0
            type: natGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-public-natgw-a"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-tgw-b"
        routes:
          - name: TgwRoute
            destination: "{{ GlobalCidr }}"
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          - name: Internet
            destination: 0.0.0.0/0
            type: natGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-public-natgw-b"
    subnets:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-fw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-fw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-egress-pool"
          netmaskLength: {{ HomeRegionEgressFwSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-fw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-fw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-egress-pool"
          netmaskLength: {{ HomeRegionEgressFwSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-public-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-public-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-egress-pool"
          netmaskLength: {{ HomeRegionEgressPublicSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-public-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-public-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-egress-pool"
          netmaskLength: {{ HomeRegionEgressPublicSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-tgw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-tgw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-egress-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-Tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-tgw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-rt-tgw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-egress-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-Tgw"
    natGateways:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-public-natgw-a"
        subnet: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-public-a"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-public-natgw-b"
        subnet: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-public-b"
    transitGatewayAttachments:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress"
        transitGateway:
          name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          account: Network
        routeTableAssociations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-firewall"
        routeTablePropagations: []
        subnets:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-tgw-a"
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-egress-tgw-b"
    gatewayEndpoints:
      defaultPolicy: Endpoint-Default
      endpoints:
        - service: s3
        - service: dynamodb
    useCentralEndpoints: true

  # VPC Inspection
  #  - Utilizes AWS Network Firewall for inspection of all traffic North-South & East-West
  #  - Utilizes two AZs for deployment of subnets, leaving space for 3rd AZ
  - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection"
    account: Network
    region: "{{ HomeRegion }}"
    ipamAllocations:
      - ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-inspection-pool"
        netmaskLength: {{ HomeRegionInspectionVpcMaskLength }}
    defaultSecurityGroupRulesDeletion: true
    internetGateway: true
    enableDnsHostnames: true
    enableDnsSupport: true
    instanceTenancy: default
    routeTables:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-rt-tgw-a"
        routes:
          - name: TgwRoute
            destination: 0.0.0.0/0
            type: networkFirewall
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-nfw"
            targetAvailabilityZone: a
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-rt-tgw-b"
        routes:
          - name: TgwRoute
            destination: 0.0.0.0/0
            type: networkFirewall
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-nfw"
            targetAvailabilityZone: b
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-rt-fw-a"
        routes:
          - name: TgwRoute
            destination: 0.0.0.0/0
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-rt-fw-b"
        routes:
          - name: TgwRoute
            destination: 0.0.0.0/0
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
    subnets:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-fw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-rt-fw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-inspection-pool"
          netmaskLength: {{ HomeRegionInspectionFwSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-fw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-rt-fw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-inspection-pool"
          netmaskLength: {{ HomeRegionInspectionFwSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-tgw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-rt-tgw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-inspection-pool"
          netmaskLength: 28
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-tgw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-rt-tgw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-inspection-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-Tgw"
    transitGatewayAttachments:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection"
        transitGateway:
          name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          account: Network
        options:
          applianceModeSupport: enable # This is required to ensure symmetric routing and maintain stateful inspection capabilities
        routeTableAssociations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-firewall"
        routeTablePropagations: []
        subnets:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-tgw-a"
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-inspection-tgw-b"
    useCentralEndpoints: true

  # VPC SharedServices
  #  - Deploys to SharedServices account
  #  - Utilizes two AZs for deployments of subnets, leaving space for 3rd AZ
  #    - Web / App / Db Subnet
  #    - Transit Gateway attachment subnet
  #  - This VPC is intended to host services which your entire organization might rely on
  - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices"
    account: SharedServices
    region: "{{ HomeRegion }}"
    ipamAllocations:
      - ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-sharedservices-pool"
        netmaskLength: {{ HomeRegionSharedServicesVpcMaskLength }}
    defaultSecurityGroupRulesDeletion: true
    internetGateway: false
    enableDnsHostnames: true
    enableDnsSupport: true
    instanceTenancy: default
    routeTables:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-web-a"
        routes:
          - name: TgwRoute
            destination: 0.0.0.0/0
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-web-b"
        routes:
          - name: TgwRoute
            destination: 0.0.0.0/0
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-app-a"
        routes:
          - name: TgwRoute
            destination: 0.0.0.0/0
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          - name: S3Gateway
            type: gatewayEndpoint
            target: s3
          - name: DynamoDBGateway
            type: gatewayEndpoint
            target: dynamodb
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-app-b"
        routes:
          - name: TgwRoute
            destination: 0.0.0.0/0
            type: transitGateway
            target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          - name: S3Gateway
            type: gatewayEndpoint
            target: s3
          - name: DynamoDBGateway
            type: gatewayEndpoint
            target: dynamodb
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-data-a"
        routes: []
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-data-b"
        routes: []

      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-tgw-a"
        routes: []
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-tgw-b"
        routes: []
    subnets:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-web-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-web-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-sharedservices-pool"
          netmaskLength: {{ HomeRegionSharedServicesWebSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-web-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-web-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-sharedservices-pool"
          netmaskLength: {{ HomeRegionSharedServicesWebSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-app-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-app-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-sharedservices-pool"
          netmaskLength: {{ HomeRegionSharedServicesAppSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-app-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-app-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-sharedservices-pool"
          netmaskLength: {{ HomeRegionSharedServicesAppSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-data-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-data-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-sharedservices-pool"
          netmaskLength: {{ HomeRegionSharedServicesDataSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-data-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-data-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-sharedservices-pool"
          netmaskLength: {{ HomeRegionSharedServicesDataSubnetMaskLength }}
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-tgw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-tgw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-sharedservices-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-Tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-tgw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-rt-tgw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-sharedservices-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-Tgw"
    transitGatewayAttachments:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices"
        transitGateway:
          name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          account: Network
        routeTableAssociations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-spoke"
        routeTablePropagations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-firewall"
        subnets:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-tgw-a"
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-sharedservices-tgw-b"
    gatewayEndpoints:
      defaultPolicy: Endpoint-Default
      endpoints:
        - service: s3
        - service: dynamodb
    useCentralEndpoints: true

  # Shared Dev VPC
  - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev"
    account: Network
    region: "{{ HomeRegion }}"
    ipamAllocations:
      - ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-dev-pool"
        netmaskLength: {{ HomeRegionSharedDevVpcMaskLength }}
    defaultSecurityGroupRulesDeletion: true
    internetGateway: false
    enableDnsHostnames: true
    enableDnsSupport: true
    instanceTenancy: default
    routeTables:
      ## Add route tables for subnets shared with accounts
      ### Example Route Table
      # - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-example-ai-a"
      #   routes:
      #     - name: TgwRoute
      #       destination: "{{ GlobalCidr }}"
      #       type: transitGateway
      #       target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
      #     - name: S3Gateway
      #       type: gatewayEndpoint
      #       target: s3
      #     - name: DynamoDBGateway
      #       type: gatewayEndpoint
      #       target: dynamodb

      ## DO NOT MODIFY ROUTE TABLES FROM THIS POINT ON
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-rt-tgw-a"
        routes: []
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-rt-tgw-b"
        routes: []
    subnets:
      ## Add subnets to be shared with accounts
      ### Example Subnet
      # - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-example-ai-a"
      #   availabilityZone: a
      #   routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-example-ai-a"
      #   ipamAllocation:
      #     ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-dev-pool"
      #     netmaskLength: 26
      #   shareTargets:
      #     accounts:
      #       - MyExampleAiDevAccount

      ## DO NOT MODIFY SUBNETS FROM THIS POINT ON
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-tgw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-rt-tgw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-dev-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-tgw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-rt-tgw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-dev-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-tgw"
    transitGatewayAttachments:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev"
        transitGateway:
          name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          account: Network
        routeTableAssociations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-spoke"
        routeTablePropagations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-firewall"
        subnets:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-tgw-a"
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-dev-tgw-b"
    gatewayEndpoints:
      defaultPolicy: Endpoint-Default
      endpoints:
        - service: s3
        - service: dynamodb
    useCentralEndpoints: true

  # Shared Test VPC
  - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test"
    account: Network
    region: "{{ HomeRegion }}"
    ipamAllocations:
      - ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-test-pool"
        netmaskLength: {{ HomeRegionSharedTestVpcMaskLength }}
    defaultSecurityGroupRulesDeletion: true
    internetGateway: false
    enableDnsHostnames: true
    enableDnsSupport: true
    instanceTenancy: default
    routeTables:
      ## Add route tables for subnets shared with accounts
      ### Example Route Table
      # - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-example-ai-a"
      #   routes:
      #     - name: TgwRoute
      #       destination: "{{ GlobalCidr }}"
      #       type: transitGateway
      #       target: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
      #     - name: S3Gateway
      #       type: gatewayEndpoint
      #       target: s3
      #     - name: DynamoDBGateway
      #       type: gatewayEndpoint
      #       target: dynamodb

      ## DO NOT MODIFY ROUTE TABLES FROM THIS POINT ON
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-rt-tgw-a"
        routes: []
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-rt-tgw-b"
        routes: []
    subnets:
      ## Add subnets to be shared with accounts
      ### Example Subnet
      # - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-example-ai-a"
      #   availabilityZone: a
      #   routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-example-ai-a"
      #   ipamAllocation:
      #     ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-test-pool"
      #     netmaskLength: 26
      #   shareTargets:
      #     accounts:
      #       - MyExampleAiTestAccount

      ## DO NOT MODIFY SUBNETS FROM THIS POINT ON
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-tgw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-rt-tgw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-test-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-tgw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-rt-tgw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-test-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-tgw"
    transitGatewayAttachments:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test"
        transitGateway:
          name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          account: Network
        routeTableAssociations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-spoke"
        routeTablePropagations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-firewall"
        subnets:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-tgw-a"
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-test-tgw-b"
    gatewayEndpoints:
      defaultPolicy: Endpoint-Default
      endpoints:
        - service: s3
        - service: dynamodb
    useCentralEndpoints: true

  # Shared Prod VPC
  - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-prod"
    account: Network
    region: "{{ HomeRegion }}"
    ipamAllocations:
      - ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-prod-pool"
        netmaskLength: {{ HomeRegionSharedProdVpcMaskLength }}
    defaultSecurityGroupRulesDeletion: true
    internetGateway: false
    enableDnsHostnames: true
    enableDnsSupport: true
    instanceTenancy: default
    routeTables:
      ## Add route tables for subnets shared with accounts
      ## DO NOT MODIFY ROUTE TABLES FROM THIS POINT ON
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-prod-rt-tgw-a"
        routes: []
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-prod-rt-tgw-b"
        routes: []
    subnets:
      ## Add subnets to be shared with accounts
      ## DO NOT MODIFY SUBNETS FROM THIS POINT ON
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-prod-tgw-a"
        availabilityZone: a
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-prod-rt-tgw-a"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-prod-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-tgw"
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-prod-tgw-b"
        availabilityZone: b
        routeTable: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-prod-rt-tgw-b"
        ipamAllocation:
          ipamPoolName: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-ipam-workloads-prod-pool"
          netmaskLength: 28
        tags:
          - key: SubnetType
            value: "{{ AcceleratorPrefix }}-tgw"
    transitGatewayAttachments:
      - name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-prod"
        transitGateway:
          name: "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw"
          account: Network
        routeTableAssociations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-spoke"
        routeTablePropagations:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-tgw-rt-firewall"
        subnets:
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-prod-tgw-a"
          - "{{ AcceleratorPrefix }}-{{ HomeRegion }}-shared-prod-tgw-b"
    gatewayEndpoints:
      defaultPolicy: Endpoint-Default
      endpoints:
        - service: s3
        - service: dynamodb
    useCentralEndpoints: true

# VPC Flow Logs
#   - Logs sent to CloudWatch Logs which are then forwarded to the log account's central logging bucket
#   - Dynamic filter created to use prefix for flow logs
vpcFlowLogs:
  trafficType: ALL
  maxAggregationInterval: 600
  destinations:
    - cloud-watch-logs
  destinationsConfig:
    cloudWatchLogs:
      retentionInDays: 30
  defaultFormat: false
  customFields:
    - version
    - account-id
    - interface-id
    - srcaddr
    - dstaddr
    - srcport
    - dstport
    - protocol
    - packets
    - bytes
    - start
    - end
    - action
    - log-status
    - vpc-id
    - subnet-id
    - instance-id
    - tcp-flags
    - type
    - pkt-srcaddr
    - pkt-dstaddr
    - region
    - az-id
    - pkt-src-aws-service
    - pkt-dst-aws-service
    - flow-direction
    - traffic-path
